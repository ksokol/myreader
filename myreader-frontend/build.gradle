plugins {
    id 'com.moowork.node' version '1.1.1'
}

apply plugin: 'com.moowork.node'
apply plugin: 'idea'

node {
    version = '8.9.1'
    npmVersion = '5.5.1'
    download = true
}

idea {
    module {
        sourceDirs += file('src/app/js')
    }
}

task test(overwrite: true,dependsOn: [npm_install, npm_test]) {
    inputs.files files('src', 'test', 'webpack.config.js', 'src/tests.webpack.js', 'package.json', 'karma.conf.js')
}

task build(type: NpmTask, dependsOn: [npm_install, test]) {
    outputs.files file('dist')
    inputs.files files('src')

    args = ['run', 'build']
}

task clean() {
    delete "dist"
}

task check(dependsOn: test)

sonarqube {
    properties {
        property "sonar.sources", "${projectDir}/src/app/js"
        property "sonar.exclusions", ["**/*.spec.js", "**/test-utils.js"]
        property "sonar.tests", ["${projectDir}/test", "${projectDir}/src/app/js"]
        property "sonar.test.inclusions", ["**/*.spec.js", "**Tests.js"]
        property "sonar.javascript.lcov.reportPaths", "${buildDir}/reports/istanbul/lcov.info"
        property "sonar.testExecutionReportPaths", "${buildDir}/TESTS.xml"
    }
}

plugins {
    id 'com.moowork.node' version '1.1.1'
}

apply plugin: 'com.moowork.node'

node {
    version = '6.9.1'
    npmVersion = '3.10.8'
    download = true
}

task test(overwrite: true,dependsOn: [npm_install, npm_test]) {
    inputs.files files('src', 'test', 'webpack.config.js', 'src/tests.webpack.js', 'package.json', 'karma.conf.js')
}

task build(type: NpmTask, dependsOn: [npm_install, test]) {
    outputs.files file('dist')
    inputs.files files('src')

    args = ['run', 'build']
}

task clean() {
    delete "dist"
}

task check(dependsOn: test)

sonarqube {
    properties {
        property "sonar.sources", "${projectDir}/src/app/js"
        property "sonar.exclusions", "**/*.spec.js"
        property "sonar.tests", ["${projectDir}/test", "${projectDir}/src/app/js"]
        property "sonar.test.inclusions", ["**/*.spec.js", "**Tests.js"]
        property "sonar.javascript.lcov.reportPath", "${buildDir}/reports/istanbul/PhantomJS 2.1.1 (Linux 0.0.0)/lcov.info"
        property "sonar.testExecutionReportPaths", "${buildDir}/TESTS.xml"
    }
}
